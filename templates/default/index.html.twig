{% extends 'base.html.twig' %}

{% block title %}Hello DefaultController!{% endblock %}

{% block body %}

<div class="container">
    <div class="row mt-4">
        <div class="col-lg-4">
            <ul class="list-group mt-3 shadow-sm">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <form class="form-inline my-2 my-lg-0">
                        <input class="form-control mr-sm-2" type="search" placeholder="Rechercher" aria-label="Search">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Rechercher</button>
                    </form>
                </li>
                {% for user in users %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        <img src="{{ asset('img/avatar.png') }}" width="60" />
                    </span>

                    <span>
                        {{ user.firstName~" "~user.lastName }}
                    </span>

                    <span>
                        <a href="{{ path('send_data',{'user':user.id}) }}" class="">
                            <span class="material-icons">
                                call
                            </span>
                        </a>
                        <a href="{{ path('send_data',{'user':user.id}) }}" class="pl-2 text-warning">
                            <span class="material-icons">
                                message
                            </span>
                        </a>
                    </span>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="col-lg-8"></div>
    </div>
</div>

{% endblock %}

{% block javascripts %}
<script>
    const userId = "{{ app.user.id }}";
    const es = new EventSource('http://localhost:3000/.well-known/mercure?topic=' + encodeURIComponent('http://primus-notif-hub.com/user/' + userId));
    es.onmessage = e => {
        // Will be called every time an update is published by the server
        console.log(JSON.parse(e.data));
        playAudio();
    }
</script>
{% endblock %}